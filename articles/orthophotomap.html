<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Orthophotomap • rgugik</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Orthophotomap">
<meta property="og:description" content="rgugik">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rgugik</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/orthophotomap.html">Orthophotomap</a>
    </li>
    <li>
      <a href="../articles/DEM.html">Digital Elevation Model</a>
    </li>
    <li>
      <a href="../articles/articles/geodb_description.html">General Geographic Database</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kadyb/rgugik/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="orthophotomap_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Orthophotomap</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kadyb/rgugik/blob/master/vignettes/orthophotomap.Rmd"><code>vignettes/orthophotomap.Rmd</code></a></small>
      <div class="hidden name"><code>orthophotomap.Rmd</code></div>

    </div>

    
    
<style>
body {text-align: justify}
</style>
<div id="definition" class="section level2">
<h2 class="hasAnchor">
<a href="#definition" class="anchor"></a>Definition</h2>
<p><strong>Orthophotomap</strong> is a raster, orthogonal and cartometric representation of the terrain surface, which was created by digital processing of aerial or satellite images. During the orthorectification, geometric distortions resulting from the land relief are removed by using Digital Elevation Models. The main advantage of an orthophotomap is the ability to measure geographic coordinates (it is georeferenced).</p>
<p>The properties of the orthophotomap:</p>
<ol style="list-style-type: decimal">
<li>Spatial resolution - is related to the size of the smallest object that can be detected by the sensor and is determined by the size of the image cell (pixel). The smaller the cell, the more detail it represents. Too large a pixel means that individual objects in the scene are no longer visible.</li>
<li>Composition - analogue images will be in shades of gray, while digital images can be in natural colors (RGB) as standard or near infrared (NIR).</li>
</ol>
</div>
<div id="purpose" class="section level2">
<h2 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h2>
<p>The purpose of this exercise is to assess the vegetation condition of the selected area. We will do this based on remote sensing data (multichannel orthophotomap) and simple vegetation index.</p>
<p><strong>NDVI</strong> (Normalized Difference Vegetation Index) is a simple indicator of vegetation that uses the red and near infrared channels. Main application is monitoring and forecasting of agricultural production. It is calculated from the following formula:</p>
<center>
<span class="math inline">\(NDVI = \frac {NIR - RED} {NIR + RED}\)</span>
</center>
<p>Its value ranges from -1 to 1. The higher the value, the higher the biomass level. Values close to 0 and below are related to objects such as water, soil or buildings.</p>
</div>
<div id="analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis" class="anchor"></a>Analysis</h2>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># read packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://r-spatial.github.io/sf">"sf"</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"stars"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://kadyb.github.io/rgugik">"rgugik"</a></span>)
</pre></div>
<p>Our analysis area will be the Krajkowo nature reserve located in the Greater Poland voivodeship. It was established in 1958 in order to protect the breeding places of birds, especially the <em>grey heron</em> and the <em>great black cormorant</em>, and to protect the landscape of the Warta oxbow.</p>
<div id="vector-data" class="section level3">
<h3 class="hasAnchor">
<a href="#vector-data" class="anchor"></a>Vector data</h3>
<p>Data on nature reserves can be found in General Geographic Databases. We can get them using the function <code>geodb_download</code>. Let’s do that.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co"># 17.6 MB</span>
<span class="fu"><a href="../reference/geodb_download.html">geodb_download</a></span>(<span class="st">"wielkopolskie"</span>, outdir = <span class="st">"./data"</span>)
</pre></div>
<p>Our database consists of many files in GML (<em>Geography Markup Language</em>) format. A brief description of the structure of this database can be found <a href="https://kadyb.github.io/rgugik/articles/articles/geodb_description.html">here</a>. The table with the nature reserves can be found in the *PL.PZGIK.201.30__OT_TCRZ_A.xml* file. We will use the <strong>sf</strong> package and the <code>read_sf</code> function to load it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">reserves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_read.html">read_sf</a></span>(<span class="st">"data/PL.PZGiK.201.30/BDOO/PL.PZGIK.201.30__OT_TCRZ_A.xml"</span>)
</pre></div>
<p>Let’s check the structure of our data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span>(<span class="kw">reserves</span>)
<span class="co">## [1] 28</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span>(<span class="kw">reserves</span>)
<span class="co">## [1] 110</span>
</pre></div>
<p>In simple terms, it is a spatial table consisting of 110 observations (rows) and 28 variables (columns). The names of the objects can be found in the <strong>nazwa</strong> column. We are interested in Krajkowo reserve, so let’s choose it.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co"># selection by attribute</span>
<span class="kw">krajkowo</span> <span class="op">=</span> <span class="kw">reserves</span>[<span class="kw">reserves</span><span class="op">$</span><span class="kw">nazwa</span> <span class="op">==</span> <span class="st">"Krajkowo"</span>, ]
</pre></div>
<p>We can display it in two ways:</p>
<ol style="list-style-type: decimal">
<li>Using the <code>plot</code> function and directly specifying the column with the object geometry: <code><a href="https://rdrr.io/pkg/sf/man/plot.html">plot(krajkowo$geometry)</a></code>
</li>
<li>Using the <code>plot</code> and <code>st_geometry</code> functions, which will obtain geometry from the vector layer. In the first case, we need to know the name of the column with geometry, while in the second case, the geometry will be selected automatically (it is the safer way).</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="kw">krajkowo</span>))
</pre></div>
<p><img src="orto-GEOMETRY-1.png"></p>
<p>We can also calculate the area of this polygon.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">krajkowo_area</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/geos_measures.html">st_area</a></span>(<span class="kw">krajkowo</span>) <span class="co"># [m^2]</span>
<span class="kw">units</span>::<span class="fu"><a href="https://rdrr.io/pkg/units/man/set_units.html">set_units</a></span>(<span class="kw">krajkowo_area</span>, <span class="st">"ha"</span>) <span class="co"># convert to [ha]</span>
</pre></div>
<pre><code>## 165.2744 [ha]</code></pre>
<p>The function <code>st_area</code> returned the area in m^2, after conversion we got the result 165 ha.</p>
</div>
<div id="raster-data" class="section level3">
<h3 class="hasAnchor">
<a href="#raster-data" class="anchor"></a>Raster data</h3>
<p>Now let’s move on to the stage of downloading the orthophotomap. We will use the <code><a href="../reference/orto_request.html">orto_request()</a></code> function, which will show us what images are available in the analyzed area. As an argument of this function we will give our Krajkowo polygon.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">req_df</span> <span class="op">=</span> <span class="fu"><a href="../reference/orto_request.html">orto_request</a></span>(<span class="kw">krajkowo</span>)
</pre></div>
<p>We can display the result table using the code below.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co"># display the first 10 rows and the first 6 columns</span>
<span class="kw">req_df</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>]
</pre></div>
<pre><code>##             sheetID year resolution composition  sensor     CRS
## 1  N-33-142-B-d-4-2 2004       0.50         B/W  Analog PL-1992
## 2  N-33-142-B-d-4-4 2004       0.50         B/W  Analog PL-1992
## 3  N-33-142-B-d-4-4 2010       0.25         RGB Digital PL-1992
## 4  N-33-142-B-d-4-2 2010       0.25         RGB Digital PL-1992
## 5  N-33-142-B-d-4-4 2010       0.25         CIR Digital PL-1992
## 6  N-33-142-B-d-4-2 2010       0.25         CIR Digital PL-1992
## 7  N-33-142-B-d-4-2 2016       0.25         CIR Digital PL-1992
## 8  N-33-142-B-d-4-2 2016       0.25         RGB Digital PL-1992
## 9  N-33-142-B-d-4-4 2016       0.25         CIR Digital PL-1992
## 10 N-33-142-B-d-4-4 2016       0.25         RGB Digital PL-1992</code></pre>
<p>To complete the project task we need near infrared data, so in the next step select those rows for which the <code>composition</code> column has the value “CIR”.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="co"># select IR images and overwrite the req_df object</span>
<span class="kw">req_df</span> <span class="op">=</span> <span class="kw">req_df</span>[<span class="kw">req_df</span><span class="op">$</span><span class="kw">composition</span> <span class="op">==</span> <span class="st">"CIR"</span>, ]
</pre></div>
<p>Then let’s sort the table according to the year the photo was taken, where the most recent images will be at the beginning.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">req_df</span> <span class="op">=</span> <span class="kw">req_df</span>[<span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span>(<span class="op">-</span><span class="kw">req_df</span><span class="op">$</span><span class="kw">year</span>), ]
</pre></div>
<p>Let’s display the table again and select the newest compositions.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">req_df</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">9</span>)]
</pre></div>
<pre><code>##             sheetID year resolution composition  sensor seriesID
## 7  N-33-142-B-d-4-2 2016       0.25         CIR Digital    69837
## 9  N-33-142-B-d-4-4 2016       0.25         CIR Digital    69837
## 22 N-33-142-B-d-4-2 2013       0.25         CIR Digital    69903
## 24 N-33-142-B-d-4-4 2013       0.25         CIR Digital    69903
## 5  N-33-142-B-d-4-4 2010       0.25         CIR Digital    69763
## 6  N-33-142-B-d-4-2 2010       0.25         CIR Digital    69763</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">req_df</span> <span class="op">=</span> <span class="kw">req_df</span>[<span class="kw">req_df</span><span class="op">$</span><span class="kw">year</span> <span class="op">==</span> <span class="fl">2016</span>, ]
</pre></div>
<p>Note that the result is pairs of objects (images). This means that our Krajkowo reserve is depicted in two photos within one series. Therefore, the <code>seriesID</code> column is used to combine smaller images into larger mosaics.</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">req_df</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">9</span>)]
</pre></div>
<pre><code>##            sheetID year resolution composition  sensor seriesID
## 7 N-33-142-B-d-4-2 2016       0.25         CIR Digital    69837
## 9 N-33-142-B-d-4-4 2016       0.25         CIR Digital    69837</code></pre>
<p>The <code><a href="../reference/tile_download.html">tile_download()</a></code> function is used to download orthophotomaps, it takes our selected table as main argument.</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="co"># 61.9 MB</span>
<span class="fu"><a href="../reference/tile_download.html">tile_download</a></span>(<span class="kw">req_df</span>, outdir = <span class="st">"./data"</span>)
</pre></div>
</div>
<div id="processing" class="section level3">
<h3 class="hasAnchor">
<a href="#processing" class="anchor"></a>Processing</h3>
<p>Let’s load the downloaded orthophotomaps using the <code>read_stars()</code> function from the <strong>stars</strong> package, which allows to work on spatiotemporal arrays. In our case it is a raster consisting of three bands (NIR, R, G) for only one year. We don’t have to load the entire data array into memory (which is a very demanding task). We can read the file metadata and a certain amount of data by using the <code>proxy</code> argument and further process the data analogously.</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">img1</span> <span class="op">=</span> <span class="fu">read_stars</span>(<span class="st">"data/69837_329609_N-33-142-B-d-4-2.TIF"</span>, proxy = <span class="fl">TRUE</span>)
<span class="kw">img2</span> <span class="op">=</span> <span class="fu">read_stars</span>(<span class="st">"data/69837_329613_N-33-142-B-d-4-4.TIF"</span>, proxy = <span class="fl">TRUE</span>)
</pre></div>
<p>Then we will perform two operations: rasters merging and cutting to the reserve area. The use of a <code>proxy</code> allows to get the result immediately, while processing the entire image would take several minutes. Images have their own specific Coordinate Reference Systems, let’s make sure it is correct (should be EPSG 2180) after merging.</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="kw">img</span> <span class="op">=</span> <span class="fu">st_mosaic</span>(<span class="kw">img1</span>, <span class="kw">img2</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_crs.html">st_crs</a></span>(<span class="kw">img</span>) <span class="op">=</span> <span class="fl">2180</span> <span class="co"># overwrite CRS to be sure</span>
<span class="kw">img</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_crop.html">st_crop</a></span>(<span class="kw">img</span>, <span class="kw">krajkowo</span>)
</pre></div>
<p>Let’s display the effect using the <code><a href="https://rdrr.io/pkg/sf/man/plot.html">plot()</a></code> function. Defining the input bands in the <code>rgb</code> argument creates a composition consisting of three bands. We use NIR, R and G bands. The composition below is shown in infrared, not in natural colors, which may be misinterpreted from the <code>rgb</code> argument.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="kw">img</span>, rgb = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>), main = <span class="kw">NULL</span>, axes = <span class="fl">TRUE</span>)
</pre></div>
<p><img src="orto-CIR-1.png"></p>
<p>In the last step, calculate the NDVI using the near infrared (1) and red (2) bands.</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="kw">calc_ndvi</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">img</span>) (<span class="kw">img</span>[<span class="fl">1</span>] <span class="op">-</span> <span class="kw">img</span>[<span class="fl">2</span>]) <span class="op">/</span> (<span class="kw">img</span>[<span class="fl">1</span>] <span class="op">+</span> <span class="kw">img</span>[<span class="fl">2</span>])
<span class="kw">ndvi</span> <span class="op">=</span> <span class="fu">st_apply</span>(<span class="kw">img</span>, MARGIN = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"x"</span>, <span class="st">"y"</span>), FUN = <span class="kw">calc_ndvi</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="kw">ndvi</span>, main = <span class="st">"NDVI"</span>)
</pre></div>
<p><img src="orto-NDVI-1.png"></p>
<p>A surprising observation is the relatively low NDVI values for the forest area. There are two reasons for this, i.e. the photos are taken in the autumn and probably have not been calibrated. For this reason, a better source of data for analysis may be satellite images, which are calibrated spectrally and obtained continuously (if no cloudiness occurs).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Krzysztof Dyba, Jakub Nowosad.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
